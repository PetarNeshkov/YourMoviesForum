@model ChatMessageInputModel
@{
    ViewData["Title"] = "Send message";
}

<link href="~/css/sendMessagechat.css" rel="stylesheet" type="text/css" />

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
</head>
<body>
    <div class="main">
       <div class="col-md-7">
            <div class="separator">
                <h4 class="ml-3">@ViewData["Title"]</h4>
            </div>
            <div>
                <div class="col-md-4">
                    <div class="form-group">
                        <h4 class="mt-2">To:</h4>
                        <select asp-for="ReceiverId" id="input-users">
                            @foreach (var user in Model.Users.Where(u => u.Id != User.Id()))
                            {
                                <option value="@user.Id">@user.UserName</option>
                            }
                        </select>
                        <span asp-validation-for="ReceiverId" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="ml-4">
                <div>
                    <form id="addMessage"
                          asp-controller="Chat"
                          asp-action="Message"
                          method="post">
                        <input value="@Model.ReceiverId" name="ReceiverId" hidden />
                        <div class="form-group">
                            <textarea id="messageBox" asp-for="Message" class="form-control" placeholder="Enter what you think..."></textarea>
                            <span asp-validation-for="Message" class="text-danger"></span>
                        </div>
                        <div class="pt-row">
                            <div class="col-auto ml-auto">
                                <button class="btn btn-primary btn-lg" id="sendButton" type="submit">Send</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-5">
            <h4 id="message-element">Messages</h4>
            <i id="element" class="fas fa-user-edit"></i>
            <div class="separator"></div>
            <div class="recieved-messages">
                @if (Model.RecievedMessages.Any())
                {
                    foreach (var conversation in Model.RecievedMessages.OrderByDescending(x=>x.LastMessageActivity))
                    {
                      <div class="message">
                        <a onclick="location.href = '/Chat/WithUser/@conversation.Id';" href="#" class="current-item">
                                <h4 class="user-section">
                                    <span class="username hover-underline-animation">@conversation.UserName</span>
                                    <span class="time">@conversation.LastMessageActivity</span>
                                </h4>
                                <div class="lastMessage">@conversation.LastMessage</div>
                        </a>
                      </div>
                    }
                }
                else
                {
                    <div class="not-found">
                        <p>You don't have any messages yet.</p>
                        <p>But you can <a asp-controller="Chat" asp-action="Message" id="underline">send</a> one now.</p>
                    </div>
                }
            </div>
         </div>
    </div>
</body>
</html>

@section Scripts{
 <partial name="_ValidationScriptsPartial" />
<script>
        $('#input-users').on('change', function () {
            var valueSelected = this.value;
            $("#addMessageForm input[name='ReceiverId']").val(valueSelected);
        });
        var $select = $('#input-users').selectize({
            create: false,
            sortField: 'text',
            placeholder: 'Write a message to'
        });
        $select.each(function () {
            $(this)[0].selectize.clear(true);
        });
</script>
}
